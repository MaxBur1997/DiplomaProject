{% extends 'base.html' %}

{% block title %}Product Details{% endblock %}

{% block content %}
<h2>{{ product.name }}</h2>
<img src="{{ product.image_url }}" alt="{{ product.name }}" width="300">
<p><strong>Description:</strong> {{ product.description }}</p>
<p><strong>Price:</strong> ${{ product.price }}</p>

<hr>

<!-- Добавление товара в корзину -->
<h3>Add to Basket</h3>
<form action="{{ url_for('basket.add_to_basket', product_id=product.id) }}" method="post" style="margin-bottom: 1em;">
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" value="1" min="1" required>
    <button type="submit">Add to Basket</button>
</form>

<hr>

<h3>Reviews</h3>

<!-- Элементы управления сортировкой -->
<form action="{{ url_for('product.product_detail', product_id=product.id) }}" method="get" style="margin-bottom: 1em;">
    <label for="sort_by">Sort by:</label>
    <select id="sort_by" name="sort_by">
        <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Date</option>
        <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>Rating</option>
    </select>

    <label for="order">Order:</label>
    <select id="order" name="order">
        <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
        <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
    </select>

    <button type="submit">Sort</button>
</form>

{% if reviews %}
    <ul>
        {% for review in reviews %}
            <li>
                <strong>{{ review.user_name }}</strong> rated {{ review.rating }}/5
                <p>{{ review.comment }}</p>
                <small>Posted on {{ review.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</small>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No reviews yet. Be the first to review this product!</p>
{% endif %}

<hr>

<h3>Add a Review</h3>
<form action="{{ url_for('review.add_review') }}" method="post">
    <input type="hidden" name="product_id" value="{{ product.id }}">
    <label for="user_name">Your Name:</label>
    <input type="text" id="user_name" name="user_name" required>

    <label for="rating">Rating:</label>
    <select id="rating" name="rating" required>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>

    <label for="comment">Comment:</label>
    <textarea id="comment" name="comment" rows="4"></textarea>

    <button type="submit">Submit Review</button>
</form>

<a href="{{ url_for('product.list_products') }}">Back to Products</a>
{% endblock %}
